<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by perltidy on Mon Oct  9 23:13:45 2006 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>search2.pl</title>
<link rel="stylesheet" href="style.css" type="text/css" /></head>
<body>
<a name="-top-"></a>
<h1>search2.pl</h1>
<!-- BEGIN CODE INDEX --><a name="code-index"></a>
<ul>
<li><a href="#pop_word-">package main</a>
<ul>
<li><a href="#pop_word-">pop_word</a></li>
<li><a href="#report-">report</a></li>
<li><a href="#level_n-">level_n</a></li>
<li><a href="#dumpit-">dumpit</a></li>
<li><a href="#seen-">seen</a></li>
<li><a href="#adjacents-">adjacents</a></li>
<li><a href="#push_word-">push_word</a></li>
</ul>
</li>
<li><a href="#EOF-">EOF</a></li>
</ul>
<!-- END CODE INDEX -->
<hr />
<!-- contents of filename: search2.pl -->
<pre>
   1 #! perl -wl
   2 <span class="c"># args word word dict</span>
   3 <span class="c"># Dodgsonian doublets</span>
   4 <span class="c">#</span>
   5 
   6 <span class="k">use</span> <span class="w">MyCanon</span><span class="sc">;</span>
   7 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
   8 <span class="c"># use vars qw[ $debug ]; ## Globals;</span>
   9 <span class="k">use</span> <span class="w">Getopt::Long</span><span class="sc">;</span>
  10 <span class="k">INIT</span> <span class="s">{</span>
  11   <span class="k">our</span> <span class="i">$is_reversed</span><span class="sc">;</span>
  12   <span class="k">our</span> <span class="i">$limit</span>=<span class="n">20</span><span class="sc">;</span>
  13   <span class="k">our</span> <span class="i">$debug</span>=<span class="i">$ENV</span>{<span class="w">DEBUG</span>}||<span class="n">0</span><span class="sc">;</span>
  14   <span class="k">our</span> <span class="i">$trace</span><span class="sc">;</span>
  15 
  16 
  17   <span class="k">unless</span> <span class="s">(</span><span class="i">GetOptions</span><span class="s">(</span><span class="q">&quot;--reversed&quot;</span> <span class="cm">=&gt;</span> \<span class="i">$is_reversed</span><span class="cm">,</span>
  18 		     <span class="q">&quot;--limit=i&quot;</span>  <span class="cm">=&gt;</span> \<span class="i">$limit</span><span class="cm">,</span>
  19 		     <span class="q">&quot;--debug&quot;</span>    <span class="cm">=&gt;</span> \<span class="i">$debug</span><span class="cm">,</span>
  20 		     <span class="q">&quot;--trace&quot;</span>    <span class="cm">=&gt;</span> \<span class="i">$trace</span><span class="cm">,</span>
  21 		     <span class="s">)</span><span class="s">)</span>
  22       <span class="s">{</span>
  23 	  <span class="k">die</span> <span class="q">&quot;flags --reversed --limit=$limit --debug&quot;</span><span class="sc">;</span>
  24       <span class="s">}</span>
  25 
  26 
  27   
  28   <span class="k">my</span> <span class="i">$word1</span>=<span class="k">shift</span> <span class="i">@ARGV</span><span class="sc">;</span>
  29   <span class="k">my</span> <span class="i">$word2</span>=<span class="k">shift</span> <span class="i">@ARGV</span><span class="sc">;</span>
  30   <span class="k">our</span> <span class="i">@Queue</span><span class="sc">;</span>
  31 
  32 
  33   <span class="k">our</span> <span class="i">$start</span>=<span class="i">$word1</span><span class="sc">;</span>
  34   <span class="k">our</span> <span class="i">$target</span>=<span class="i">$word2</span><span class="sc">;</span>
  35   <span class="k">my</span> <span class="i">$n</span>= <span class="k">length</span> <span class="i">$word1</span><span class="sc">;</span>
  36   <span class="k">die</span> <span class="q">&quot;Not same length $word1 $word2&quot;</span>
  37 	<span class="k">unless</span> <span class="k">length</span><span class="s">(</span><span class="i">$word1</span><span class="s">)</span>==<span class="k">length</span><span class="s">(</span><span class="i">$word2</span><span class="s">)</span><span class="sc">;</span>
  38 
  39 
  40   <span class="k">my</span> <span class="i">@Stops</span><span class="sc">;</span>
  41   <span class="k">if</span> <span class="s">(</span><span class="k">-r</span> <span class="q">&#39;stopwords.txt&#39;</span><span class="s">)</span> <span class="s">{</span>
  42       <span class="k">my</span> <span class="i">$stop</span><span class="sc">;</span>
  43       <span class="k">open</span> <span class="i">$stop</span><span class="cm">,</span> <span class="q">&#39;&lt;&#39;</span><span class="cm">,</span> <span class="q">&#39;stopwords.txt&#39;</span> <span class="k">or</span> <span class="k">die</span> <span class="q">&#39;stopwords.txt failed&#39;</span><span class="sc">;</span>
  44       <span class="i">@Stops</span>= <span class="k">map</span> <span class="s">{</span><span class="k">chomp</span><span class="sc">;</span> <span class="i">$_</span><span class="s">}</span> <span class="q">&lt;$stop&gt;</span><span class="sc">;</span>
  45 
  46   <span class="s">}</span>
  47   <span class="k">my</span> <span class="i">%Stop</span>= <span class="k">map</span> <span class="s">{</span> <span class="i">$_</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">}</span> <span class="i">@Stops</span><span class="sc">;</span>
  48   
  49   <span class="k">our</span> <span class="i">@Words</span>=<span class="k">grep</span> <span class="s">{</span><span class="k">chomp</span><span class="sc">;</span> 
  50                    <span class="k">length</span> == <span class="i">$n</span> 
  51                    <span class="k">and</span> ! <span class="i">$Stop</span>{<span class="i">$_</span>} 
  52 	               <span class="s">}</span> &lt;&gt;<span class="sc">;</span>
  53   <span class="k">warn</span> <span class="q">&quot;read @{[scalar @Words]} words&quot;</span><span class="sc">;</span>
  54 <span class="s">}</span>
  55 
  56 <span class="c">####################################</span>
  57 
  58 
  59 <span class="c"># From init</span>
  60 <span class="k">our</span> <span class="s">(</span><span class="i">$start</span><span class="cm">,</span><span class="i">$target</span><span class="cm">,</span>  <span class="i">@Queue</span><span class="cm">,</span>  <span class="i">@Words</span><span class="s">)</span><span class="sc">;</span>
  61 <span class="k">our</span> <span class="s">(</span><span class="i">$is_reversed</span><span class="cm">,</span><span class="i">$debug</span><span class="cm">,</span><span class="i">$limit</span><span class="cm">,</span><span class="i">$trace</span><span class="s">)</span><span class="sc">;</span> <span class="c"># Flags</span>
  62 
  63 
  64 <span class="c"># Used here</span>
  65 <span class="k">our</span> <span class="s">(</span><span class="i">%Predicessor</span><span class="s">)</span><span class="sc">;</span>
  66 
  67 
  68 <span class="k">sub </span><span class="m">pop_word</span><span class="sc">;</span>
  69 
<a name="pop_word-"></a>  70 <span class="k">sub </span><span class="m">pop_word</span> <span class="s">{</span>
  71     <span class="k">print</span> <span class="q">&quot;POP OUT&quot;</span> <span class="k">and</span> <span class="k">return</span> <span class="k">if</span> <span class="i">@Queue</span> &lt; <span class="n">1</span><span class="sc">;</span> <span class="c"># recursion ends when done</span>
  72 
  73     <span class="k">my</span> <span class="i">$word</span>=<span class="k">pop</span> <span class="i">@</span>{<span class="i">$Queue</span>[<span class="n">-1</span>]-&gt;{<span class="w">next</span>}}<span class="sc">;</span>
  74     <span class="k">print</span> <span class="q">&quot;popping &quot;</span><span class="cm">,</span> <span class="i">$word</span>||<span class="q">&#39;*NULL*&#39;</span> <span class="k">if</span> <span class="i">$debug</span>&gt;<span class="n">3</span><span class="sc">;</span>
  75 
  76     <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$word</span> <span class="k">and</span> <span class="i">$word</span><span class="s">)</span> 
  77     <span class="s">{</span>
  78 	<span class="k">push</span> <span class="i">@</span>{<span class="i">$Queue</span>[<span class="n">-1</span>]-&gt;{<span class="w">seen</span>}}<span class="cm">,</span><span class="i">$word</span><span class="sc">;</span> <span class="c"># remember it</span>
  79     <span class="s">}</span>
  80     <span class="k">else</span> 
  81     <span class="s">{</span>
  82 	<span class="k">print</span> <span class="q">&quot;no word for &quot;</span><span class="cm">,</span><span class="i">$Queue</span>[<span class="n">-1</span>]-&gt;{<span class="w">word</span>}<span class="cm">,</span><span class="q">&quot;\n&quot;</span> <span class="k">if</span> <span class="i">$debug</span> &gt; <span class="n">3</span><span class="sc">;</span>
  83 	<span class="k">pop</span> <span class="i">@Queue</span><span class="sc">;</span>
  84 	<span class="k">return</span><span class="sc">;</span>
  85     <span class="s">}</span> 
  86     <span class="k">return</span> <span class="i">$word</span><span class="sc">;</span>
  87 <span class="s">}</span>
  88 
<a name="report-"></a>  89 <span class="k">sub </span><span class="m">report</span> <span class="s">{</span>
  90     <span class="k">my</span> <span class="s">(</span><span class="i">$first</span><span class="cm">,</span> <span class="i">$last</span><span class="s">)</span>=<span class="i">@_</span><span class="sc">;</span>
  91 
  92     <span class="k">join</span><span class="s">(</span> <span class="q">&#39; &#39;</span><span class="cm">,</span>
  93 	  <span class="i">$first</span><span class="cm">,</span> 
  94 	   <span class="k">join</span><span class="s">(</span> <span class="q">&#39;=&gt;&#39;</span><span class="cm">,</span> 
  95 		 <span class="k">map</span><span class="s">(</span> <span class="s">{</span>  <span class="i">$_</span>-&gt;{<span class="w">word</span>} <span class="s">}</span> <span class="i">@Queue</span><span class="s">)</span>
  96 		 <span class="s">)</span><span class="cm">,</span>
  97 
  98 	   <span class="i">$last</span>
  99 	   <span class="s">)</span><span class="sc">;</span>
 100 <span class="s">}</span>
 101 
<a name="level_n-"></a> 102 <span class="k">sub </span><span class="m">level_n</span> <span class="s">{</span>
 103     <span class="k">my</span> <span class="i">$n</span> = <span class="k">shift</span><span class="sc">;</span>
 104     <span class="k">join</span> <span class="s">(</span><span class="q">&#39; &#39;</span><span class="cm">,</span>
 105 	  <span class="i">$Queue</span>[<span class="i">$n</span>]-&gt;{<span class="w">word</span>}<span class="cm">,</span>
 106 	  <span class="q">&#39;=&gt;[&#39;</span><span class="cm">,</span>
 107 	  <span class="i">@</span>{<span class="i">$Queue</span>[<span class="i">$n</span>]-&gt;{<span class="w">next</span>}}<span class="cm">,</span>
 108 	  <span class="q">&#39;|&#39;</span><span class="cm">,</span>
 109 	  <span class="i">@</span>{<span class="i">$Queue</span>[<span class="i">$n</span>]-&gt;{<span class="w">seen</span>}}<span class="cm">,</span>
 110 	  <span class="q">&quot;]&quot;</span>
 111 	  <span class="s">)</span><span class="sc">;</span>
 112        <span class="s">}</span>
 113 
<a name="dumpit-"></a> 114 <span class="k">sub </span><span class="m">dumpit</span> <span class="s">{</span>
 115     <span class="k">if</span> <span class="s">(</span><span class="i">$debug</span>&gt;<span class="n">2</span><span class="s">)</span> 
 116     <span class="s">{</span>
 117 	<span class="k">print</span> <span class="k">for</span>  <span class="k">map</span> <span class="s">{</span> <span class="i">level_n</span> <span class="i">$_</span> <span class="s">}</span> <span class="n">0</span>..<span class="i">$#Queue</span><span class="sc">;</span>
 118     <span class="k">print</span> <span class="q">&quot;===========================\n&quot;</span><span class="sc">;</span>
 119     <span class="s">}</span>
 120     <span class="k">else</span> 
 121     <span class="s">{</span>
 122         <span class="k">my</span> <span class="i">$n</span>=<span class="i">$#Queue</span><span class="sc">;</span>
 123 	<span class="k">print</span> <span class="q">q{ }</span>x<span class="i">$n</span><span class="cm">,</span> <span class="i">$n</span><span class="cm">,</span> <span class="q">&#39; &#39;</span><span class="cm">,</span> <span class="i">level_n</span><span class="s">(</span><span class="i">$n</span><span class="s">)</span><span class="sc">;</span>
 124     <span class="s">}</span>
 125 
 126 <span class="s">}</span>
 127 
 128 
<a name="seen-"></a> 129 <span class="k">sub </span><span class="m">seen</span> <span class="s">{</span>
 130     <span class="k">my</span> <span class="i">$x</span>=<span class="k">shift</span><span class="sc">;</span>
 131     <span class="k">for</span> <span class="k">my</span> <span class="i">$y</span> <span class="s">(</span><span class="k">map</span> <span class="s">{</span> <span class="s">(</span> <span class="i">$_</span>-&gt;{<span class="w">word</span>}<span class="cm">,</span> 
 132                        <span class="i">@</span>{<span class="i">$_</span>-&gt;{<span class="w">next</span>}}<span class="cm">,</span> 
 133 			 <span class="i">@</span>{<span class="i">$_</span>-&gt;{<span class="w">seen</span>}}
 134 		         <span class="s">)</span><span class="s">}</span> 
 135 		                 <span class="i">@Queue</span> <span class="s">)</span>
 136     <span class="s">{</span>
 137 	<span class="k">return</span> <span class="n">1</span> <span class="k">if</span> <span class="i">$x</span> <span class="k">eq</span> <span class="i">$y</span><span class="sc">;</span>
 138     <span class="s">}</span>
 139     <span class="k">return</span><span class="sc">;</span>
 140 <span class="s">}</span>
 141 
 142 
<a name="adjacents-"></a> 143 <span class="k">sub </span><span class="m">adjacents</span> <span class="s">{</span>
 144     <span class="k">my</span> <span class="i">$word</span>=<span class="k">shift</span><span class="sc">;</span>
 145     <span class="k">my</span> <span class="i">$pat</span>=<span class="i">adjacent_pattern</span><span class="s">(</span><span class="i">$word</span><span class="s">)</span><span class="sc">;</span>
 146     <span class="k">my</span> <span class="i">@next</span>=
 147 	<span class="k">grep</span> <span class="s">{</span>
 148 	    <span class="q">/$pat/</span> 
 149 		<span class="k">and</span> ! <span class="i">seen</span><span class="s">(</span><span class="i">$_</span><span class="s">)</span> 
 150 	    <span class="s">}</span> <span class="i">@Words</span><span class="sc">;</span>
 151     <span class="c"># print &quot;adjacent($word)= /$pat/ [@next]&quot; if $debug;</span>
 152     <span class="k">return</span> <span class="i">@next</span><span class="sc">;</span>
 153 <span class="s">}</span>
 154 
 155 
<a name="push_word-"></a> 156 <span class="k">sub </span><span class="m">push_word</span> <span class="s">{</span>
 157     <span class="k">our</span> <span class="i">$is_reversed</span><span class="sc">;</span>
 158     <span class="k">my</span> <span class="i">$word</span>=<span class="k">shift</span><span class="sc">;</span>
 159     <span class="k">return</span> <span class="k">if</span> <span class="i">@Queue</span> &gt;= <span class="i">$limit</span><span class="sc">;</span>
 160     <span class="k">print</span> <span class="q">&quot;# push($word)&quot;</span> <span class="k">if</span> <span class="i">$debug</span> &gt; <span class="n">2</span><span class="sc">;</span>
 161     <span class="k">push</span> <span class="i">@Queue</span><span class="cm">,</span>
 162        <span class="s">{</span> <span class="w">word</span><span class="cm">=&gt;</span><span class="i">$word</span><span class="cm">,</span>
 163           <span class="w">next</span><span class="cm">=&gt;</span><span class="s">[</span> <span class="i">$is_reversed</span> ? <span class="k">reverse</span> <span class="i">adjacents</span><span class="s">(</span><span class="i">$word</span><span class="s">)</span> <span class="co">:</span> <span class="i">adjacents</span><span class="s">(</span><span class="i">$word</span><span class="s">)</span><span class="s">]</span><span class="cm">,</span>
 164 	  <span class="i">seen</span><span class="cm">=&gt;</span> <span class="s">[</span><span class="s">]</span><span class="cm">,</span>
 165         <span class="s">}</span><span class="sc">;</span>
 166 
 167 <span class="s">}</span>
 168 
 169 <span class="i">push_word</span><span class="s">(</span><span class="i">$start</span><span class="s">)</span><span class="sc">;</span>
 170 
 171 
 172 
 173 <span class="k">warn</span> <span class="i">report</span><span class="s">(</span><span class="q">&#39;[plan:&#39;</span><span class="cm">,</span> <span class="q">&quot;==&gt; $target ]&quot;</span><span class="s">)</span><span class="sc">;</span>
 174 
 175 <span class="i">dumpit</span><span class="s">(</span><span class="s">)</span> <span class="k">if</span> <span class="i">$debug</span><span class="sc">;</span>
 176 
 177 <span class="k">local</span> <span class="i">$|</span>=<span class="n">1</span><span class="sc">;</span>
 178 
 179 <span class="k">while</span> <span class="s">(</span><span class="i">@Queue</span><span class="s">)</span>
 180 <span class="s">{</span>
 181    <span class="k">printf</span> <span class="q">&quot;\015%5d %s&quot;</span><span class="cm">,</span> <span class="k">scalar</span> <span class="i">@Queue</span><span class="cm">,</span> <span class="i">report</span><span class="s">(</span><span class="q">&#39;[&#39;</span><span class="cm">,</span><span class="q">&#39;]&#39;</span><span class="s">)</span>
 182        <span class="k">if</span> <span class="i">$trace</span><span class="sc">;</span>
 183 
 184    <span class="k">my</span> <span class="i">$word</span>=<span class="i">pop_word</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 185    
 186    <span class="k">print</span><span class="s">(</span><span class="q">&quot;# word=@{[$word||q{}]}&quot;</span><span class="s">)</span> <span class="k">if</span> <span class="i">$debug</span>&gt;<span class="n">2</span><span class="sc">;</span>
 187 
 188 					      <span class="c"># level_n($#Queue);</span>
 189 
 190     <span class="k">if</span> <span class="s">(</span><span class="i">$word</span> <span class="k">and</span> <span class="i">$word</span> <span class="k">eq</span> <span class="i">$target</span><span class="s">)</span>
 191     <span class="s">{</span>
 192 	<span class="k">print</span> <span class="q">&quot; =&gt; $target  ** FOUND ** &quot;</span>             <span class="k">if</span> <span class="i">$trace</span><span class="sc">;</span>
 193 	<span class="k">print</span> <span class="i">report</span><span class="s">(</span><span class="q">&quot;\n*Found*&quot;</span><span class="cm">,</span> <span class="q">&quot;=&gt;$target\n&quot;</span> <span class="s">)</span> <span class="k">unless</span> <span class="i">$trace</span><span class="sc">;</span>
 194     <span class="s">}</span>
 195     <span class="k">elsif</span><span class="s">(</span><span class="i">$word</span><span class="s">)</span>
 196     <span class="s">{</span>
 197 	<span class="c"># next if seen($word);</span>
 198 	<span class="i">push_word</span><span class="s">(</span><span class="i">$word</span><span class="s">)</span><span class="sc">;</span> <span class="c"># recurse depth first</span>
 199 	<span class="c"># report(&#39;[&#39;,&#39;]&#39;);</span>
 200     <span class="s">}</span>
 201     <span class="c"># else, we popped a bracket, continue</span>
 202 
 203    <span class="i">dumpit</span><span class="s">(</span><span class="s">)</span> <span class="k">if</span> <span class="i">$debug</span><span class="sc">;</span>
 204 
 205 
 206       
 207 <span class="s">}</span>
 208 
<a name="EOF-"></a></pre>
</body>
</html>
