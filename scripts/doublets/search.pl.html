<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by perltidy on Mon Oct  9 23:20:55 2006 -->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>search.pl</title>
<link rel="stylesheet" href="style.css" type="text/css" /></head>
<body>
<a name="-top-"></a>
<h1>search.pl</h1>
<hr />
<!-- contents of filename: search.pl -->
<pre>
   1 #! perl -wl
   2 <span class="c"># args word word dict</span>
   3 <span class="c"># Dodgsonian doublets</span>
   4 <span class="c">#</span>
   5 
   6 <span class="k">use</span> <span class="w">MyCanon</span><span class="sc">;</span>
   7 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
   8 
   9 <span class="k">INIT</span> <span class="s">{</span>
  10   <span class="k">our</span> <span class="i">$is_reversed</span><span class="sc">;</span>
  11   <span class="k">while</span><span class="s">(</span><span class="i">$ARGV</span>[<span class="n">0</span>] =~ <span class="q">/^-/</span><span class="s">)</span> <span class="s">{</span>
  12       <span class="k">my</span> <span class="i">$opt</span>=<span class="k">shift</span> <span class="i">@ARGV</span><span class="sc">;</span>
  13       <span class="i">$is_reversed</span>=<span class="n">1</span> <span class="k">if</span> <span class="i">$opt</span> <span class="k">eq</span> <span class="q">q{-r}</span> <span class="sc">;</span>
  14   <span class="s">}</span>
  15 
  16 
  17   <span class="k">my</span> <span class="i">$word1</span>=<span class="k">shift</span> <span class="i">@ARGV</span><span class="sc">;</span>
  18   <span class="k">my</span> <span class="i">$word2</span>=<span class="k">shift</span> <span class="i">@ARGV</span><span class="sc">;</span>
  19   <span class="k">our</span> <span class="i">@Queue</span><span class="sc">;</span>
  20   <span class="k">our</span> <span class="i">%Seen</span><span class="sc">;</span>
  21   <span class="k">our</span> <span class="i">$start</span>=<span class="i">$word1</span><span class="sc">;</span>
  22   <span class="k">our</span> <span class="i">$target</span>=<span class="i">$word2</span><span class="sc">;</span>
  23   <span class="k">my</span> <span class="i">$n</span>= <span class="k">length</span> <span class="i">$word1</span><span class="sc">;</span>
  24   <span class="k">die</span> <span class="q">&quot;Not same length $word1 $word2&quot;</span>
  25 	<span class="k">unless</span> <span class="k">length</span><span class="s">(</span><span class="i">$word1</span><span class="s">)</span>==<span class="k">length</span><span class="s">(</span><span class="i">$word2</span><span class="s">)</span><span class="sc">;</span>
  26 
  27 
  28   <span class="k">my</span> <span class="i">@Stops</span><span class="sc">;</span>
  29   <span class="k">if</span> <span class="s">(</span><span class="k">-r</span> <span class="q">&#39;stopwords.txt&#39;</span><span class="s">)</span> <span class="s">{</span>
  30       <span class="k">my</span> <span class="i">$stop</span><span class="sc">;</span>
  31       <span class="k">open</span> <span class="i">$stop</span><span class="cm">,</span> <span class="q">&#39;&lt;&#39;</span><span class="cm">,</span> <span class="q">&#39;stopwords.txt&#39;</span> <span class="k">or</span> <span class="k">die</span> <span class="q">&#39;stopwords.txt failed&#39;</span><span class="sc">;</span>
  32       <span class="i">@Stops</span>= <span class="k">map</span> <span class="s">{</span><span class="k">chomp</span><span class="sc">;</span> <span class="i">$_</span><span class="s">}</span> <span class="q">&lt;$stop&gt;</span><span class="sc">;</span>
  33    <span class="c">#   print &quot;STOP: &#39;$_&#39;&quot; for @Stops; exit;</span>
  34   <span class="s">}</span>
  35   <span class="k">my</span> <span class="i">%Stop</span>= <span class="k">map</span> <span class="s">{</span> <span class="i">$_</span> <span class="cm">=&gt;</span> <span class="n">1</span> <span class="s">}</span> <span class="i">@Stops</span><span class="sc">;</span>
  36   
  37   <span class="k">our</span> <span class="i">@Words</span>=<span class="k">grep</span> <span class="s">{</span><span class="k">chomp</span><span class="sc">;</span> 
  38                    <span class="k">length</span> == <span class="i">$n</span> 
  39                    <span class="k">and</span> ! <span class="i">$Stop</span>{<span class="i">$_</span>} 
  40 	               <span class="s">}</span> &lt;&gt;<span class="sc">;</span>
  41   <span class="k">warn</span> <span class="q">&quot;read @{[scalar @Words]} words&quot;</span><span class="sc">;</span>
  42 <span class="s">}</span>
  43 
  44 <span class="c"># From init</span>
  45 <span class="k">our</span> <span class="s">(</span><span class="i">$start</span><span class="cm">,</span><span class="i">$target</span><span class="cm">,</span><span class="i">@Queue</span><span class="cm">,</span>  <span class="i">@Words</span><span class="s">)</span><span class="sc">;</span>
  46 <span class="k">our</span> <span class="i">$is_reversed</span><span class="sc">;</span>
  47 
  48 <span class="c"># Used here</span>
  49 <span class="k">our</span> <span class="s">(</span><span class="i">%Seen</span><span class="cm">,</span><span class="i">%Predicessor</span><span class="s">)</span><span class="sc">;</span>
  50 
  51 
  52 <span class="k">push</span> <span class="i">@Queue</span><span class="cm">,</span> <span class="i">$target</span><span class="sc">;</span> <span class="c"># work backwards</span>
  53 
  54 <span class="k">while</span> <span class="s">(</span><span class="k">my</span> <span class="i">$word</span>=<span class="k">shift</span> <span class="i">@Queue</span><span class="s">)</span><span class="s">{</span>
  55 	<span class="k">next</span> <span class="k">if</span> <span class="i">$Seen</span>{<span class="i">$word</span>}<span class="sc">;</span>
  56 	<span class="i">$Seen</span>{<span class="i">$word</span>}++<span class="sc">;</span>
  57 	<span class="k">my</span> <span class="i">$pat</span>=<span class="i">adjacent_pattern</span><span class="s">(</span><span class="i">$word</span><span class="s">)</span><span class="sc">;</span>
  58 	<span class="k">my</span> <span class="i">@Neighbors</span>=<span class="k">grep</span> <span class="s">{</span><span class="q">/$pat/</span><span class="s">}</span> <span class="i">@Words</span><span class="sc">;</span>
  59 	<span class="k">push</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$Predicessor</span>{<span class="i">$_</span>}}<span class="cm">,</span> <span class="i">$word</span><span class="s">)</span> <span class="k">for</span> <span class="i">@Neighbors</span><span class="sc">;</span>
  60 
  61 	<span class="k">if</span> <span class="s">(</span><span class="n">0</span><span class="s">)</span> <span class="s">{</span>
  62 	   <span class="k">print</span> <span class="q">&quot;Q: @Queue&quot;</span><span class="sc">;</span>
  63 	   <span class="k">print</span> <span class="q">&quot;W: $word =&gt; @Neighbors&quot;</span><span class="sc">;</span>
  64 	   <span class="k">print</span> <span class="q">&quot;&quot;</span><span class="sc">;</span>
  65 	  <span class="s">}</span> 
  66 
  67 	<span class="k">last</span> <span class="k">if</span> <span class="k">grep</span> <span class="s">{</span><span class="q">/$start/</span><span class="s">}</span> <span class="i">@Neighbors</span><span class="sc">;</span>
  68 	<span class="k">push</span> <span class="i">@Queue</span><span class="cm">,</span> <span class="i">$_</span> <span class="k">for</span> <span class="k">grep</span> <span class="s">{</span>!<span class="i">$Seen</span>{<span class="i">$_</span>}<span class="s">}</span>
  69 	         <span class="i">$is_reversed</span> ?  <span class="k">reverse</span> <span class="i">@Neighbors</span>
  70 	                      <span class="co">:</span> <span class="i">@Neighbors</span><span class="sc">;</span>
  71 
  72 <span class="s">}</span>
  73 
  74 <span class="k">if</span> <span class="s">(</span><span class="i">$Predicessor</span>{<span class="i">$target</span>}<span class="s">)</span> <span class="s">{</span>
  75   <span class="i">@Queue</span>=<span class="s">(</span><span class="i">$start</span><span class="s">)</span><span class="sc">;</span>
  76   <span class="i">%Seen</span>=<span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  77   <span class="k">while</span> <span class="s">(</span><span class="k">my</span> <span class="i">$word</span>=<span class="k">shift</span> <span class="i">@Queue</span><span class="s">)</span> <span class="s">{</span>
  78 	<span class="k">next</span> <span class="k">if</span> <span class="i">$Seen</span>{<span class="i">$word</span>}++<span class="sc">;</span>
  79 	<span class="k">my</span> <span class="i">@Next</span>=<span class="k">grep</span> <span class="s">{</span>! <span class="i">$Seen</span>{<span class="i">$_</span>}<span class="s">}</span> <span class="i">@</span>{<span class="i">$Predicessor</span>{<span class="i">$word</span>}}<span class="sc">;</span>
  80   	<span class="k">print</span> <span class="q">&quot;$word =&gt; @{[sort @Next]} &quot;</span> <span class="k">if</span> <span class="i">@Next</span><span class="cm">,</span> <span class="sc">;</span>
  81 	<span class="k">last</span> <span class="k">if</span> <span class="k">grep</span> <span class="s">{</span><span class="q">/$target/</span><span class="s">}</span> <span class="i">@Next</span><span class="sc">;</span>
  82 	<span class="k">push</span> <span class="i">@Queue</span><span class="cm">,</span> <span class="i">$_</span> <span class="k">for</span> <span class="i">@Next</span><span class="sc">;</span>
  83 
  84 	<span class="s">}</span>
  85   <span class="k">print</span> <span class="i">$target</span><span class="sc">;</span>
  86   <span class="s">}</span>
  87 <span class="k">else</span> <span class="s">{</span>
  88   <span class="k">print</span> <span class="q">&quot;*** NO ***&quot;</span><span class="sc">;</span>
  89   <span class="s">}</span>
</pre>
</body>
</html>
